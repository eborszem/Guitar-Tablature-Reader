<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Songs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/homepage.css}">
    <script type="text/javascript" th:src="@{/js/composition.js}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1><i class="fa-solid fa-guitar"></i> GUITAR MUSIC READER</h1>

    <div th:if="${!loggedIn}" class="login">
        <a href="/login"><i class="fa fa-sign-in-alt"></i> Login</a>
    </div>
    <div th:if="${loggedIn}" class="login">
        <a href="/auth/logout"><i class="fa fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="search-bar">
        <input type="text" id="song-search" placeholder="Search songs..." />
    </div>
    <div class="song-columns">
        <div class="user-songs">
            <th:block th:if="${loggedIn}">
                <button id="new-composition" class="new-composition"><i class="fa-solid fa-plus"></i></button>
            </th:block>
            <h2>Your Songs</h2>
            <ul>
                <li th:each="composition : ${userCompositions}">
                    <a 
                        th:href="@{'/song?compositionId=' + ${composition.id}}" 
                        th:text="${composition.title}"
                    >
                        Composition Name
                    </a>
                </li>
                <li th:if="${!loggedIn}" style="color: #c00; font-weight: bold;">
                    Log in to make your own songs
                </li>
            </ul>
        </div>

        <div>
            <h2>All Songs</h2>
            <ul>
                <li th:each="composition : ${allCompositions}">
                    <a 
                        th:href="@{'/song?compositionId=' + ${composition.id}}" 
                        th:text="${composition.title}"
                    >
                        Composition Name
                    </a>
                </li>
            </ul>
        </div>

        
    </div>
    <div id="popup" class="popup">
        <div class="popup-content">
            <h2>Enter song's title and composer</h2>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>
            <label for="composer">Composer:</label>
            <input type="text" id="composer" name="composer" required>
            <button id="submit">Submit</button>
            <button id="cancel">Cancel</button>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const searchInput = document.getElementById("song-search");
            searchInput.addEventListener("input", () => {
                const query = searchInput.value.toLowerCase();
                document.querySelectorAll(".song-columns > div:nth-child(1) ul li").forEach(li => {
                    const title = li.textContent.toLowerCase();
                    li.style.display = title.includes(query) ? "" : "none";
                });
                document.querySelectorAll(".song-columns > div:nth-child(2) ul li").forEach(li => {
                    const title = li.textContent.toLowerCase();
                    li.style.display = title.includes(query) ? "" : "none";
                });
            });
        });
    </script>
</body>
</html>
